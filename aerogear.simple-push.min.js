/*! AeroGear JavaScript Library - v2.0.0 - 2015-03-03
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
!function(a,b){this.AeroGear={},AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(a){var b,c,d=this[this.collectionName]||{};if(this[this.collectionName]=d,!a)return this;if("string"==typeof a)d[a]=AeroGear[this.lib].adapters[this.type](a,this.config);else if(Array.isArray(a))for(b=0;b<a.length;b++)c=a[b],"string"==typeof c?d[c]=AeroGear[this.lib].adapters[this.type](c,this.config):c.name&&(c.settings=AeroGear.extend(c.settings||{},this.config),d[c.name]=AeroGear[this.lib].adapters[c.type||this.type](c.name,c.settings));else{if(!a.name)return this;a.settings=AeroGear.extend(a.settings||{},this.config),d[a.name]=AeroGear[this.lib].adapters[a.type||this.type](a.name,a.settings)}return this[this.collectionName]=d,this},this.remove=function(a){var b,c,d=this[this.collectionName]||{};if("string"==typeof a)delete d[a];else if(Array.isArray(a))for(b=0;b<a.length;b++)c=a[b],"string"==typeof c?delete d[c]:delete d[c.name];else a&&delete d[a.name];return this[this.collectionName]=d,this}},AeroGear.extend=function(){var a,b,c,d=arguments[0];for(b=1;b<arguments.length;b++){c=arguments[b];for(a in c)d[a]=c[a]}return d},function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=p[a])});16>e;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=o;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:t,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:v+1,j=h-u+(i-v)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>u)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,v=i,t=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||s,n=0;6>n;n++)f[e+n]=m[n];return c?c:b(f)}function d(a,c,d){var e=c&&d||0;"string"==typeof a&&(c="binary"==a?new n(16):null,a=null),a=a||{};var f=a.random||(a.rng||m)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,c)for(var g=0;16>g;g++)c[e+g]=f[g];return c||b(f)}var e,f,g,h=this,i=new Array(16);if(e=function(){for(var a,a,b=i,c=0,c=0;16>c;c++)0==(3&c)&&(a=4294967296*Math.random()),b[c]=a>>>((3&c)<<3)&255;return b},h.crypto&&crypto.getRandomValues){var j=new Uint32Array(4);g=function(){crypto.getRandomValues(j);for(var a=0;16>a;a++)i[a]=j[a>>2]>>>8*(3&a)&255;return i}}try{var k=require("crypto").randomBytes;f=k&&function(){return k(16)}}catch(l){}for(var m=f||g||e,n="function"==typeof Buffer?Buffer:Array,o=[],p={},q=0;256>q;q++)o[q]=(q+256).toString(16).substr(1),p[o[q]]=q;var r=m(),s=[1|r[0],r[1],r[2],r[3],r[4],r[5]],t=16383&(r[6]<<8|r[7]),u=0,v=0,w=d;w.v1=c,w.v4=d,w.parse=a,w.unparse=b,w.BufferClass=n,w.mathRNG=e,w.nodeRNG=f,w.whatwgRNG=g;var x=h.uuid;w.noConflict=function(){return h.uuid=x,w},h.uuid=w}(),AeroGear.Notifier=function(a){return this instanceof AeroGear.Notifier?(AeroGear.Core.call(this),this.lib="Notifier",this.type=a?a.type||"vertx":"vertx",this.collectionName="clients",void this.add(a)):new AeroGear.Notifier(a)},AeroGear.Notifier.prototype=AeroGear.Core,AeroGear.Notifier.constructor=AeroGear.Notifier,AeroGear.Notifier.adapters={},AeroGear.Notifier.CONNECTING=0,AeroGear.Notifier.CONNECTED=1,AeroGear.Notifier.DISCONNECTING=2,AeroGear.Notifier.DISCONNECTED=3,AeroGear.Notifier.adapters.SimplePush=function(a,b){if(!(this instanceof AeroGear.Notifier.adapters.SimplePush))return new AeroGear.Notifier.adapters.SimplePush(a,b);b=b||{};var c=a,d=b.connectURL||"",e=b.useNative||!1,f=null,g=JSON.parse(localStorage.getItem("ag-push-store")||"{}");g.channels=g.channels||[];for(var h in g.channels)g.channels[h].state="available";localStorage.setItem("ag-push-store",JSON.stringify(g)),this.getSettings=function(){return b},this.getName=function(){return c},this.getConnectURL=function(){return d},this.setConnectURL=function(a){d=a},this.getUseNative=function(){return e},this.getClient=function(){return f},this.setClient=function(a){f=a},this.getPushStore=function(){return g},this.setPushStore=function(a){g=a,localStorage.setItem("ag-push-store",JSON.stringify(a))},this.processMessage=function(a){var b,c,d;if("register"===a.messageType&&200===a.status)b={channelID:a.channelID,version:a.version,state:"used",pushEndpoint:a.pushEndpoint},g.channels=this.updateChannel(g.channels,b),this.setPushStore(g),b.pushEndpoint=a.pushEndpoint,jQuery(navigator.push).trigger(jQuery.Event(a.channelID+"-success",{target:{result:b.pushEndpoint}}));else{if("register"===a.messageType)throw"SimplePushRegistrationError";if("unregister"===a.messageType&&200===a.status)g.channels.splice(this.findChannelIndex(g.channels,"channelID",a.channelID),1),this.setPushStore(g);else{if("unregister"===a.messageType)throw"SimplePushUnregistrationError";if("notification"===a.messageType){c=a.updates,d=JSON.parse(localStorage.getItem("ag-push-store"));for(var e=0,h=c.length;h>e;e++){var i=d.channels.filter(function(a){return a.channelID===c[e].channelID});c[e].pushEndpoint=i?i[0].pushEndpoint:"",jQuery(navigator.push).trigger(jQuery.Event("push",{message:c[e]}))}a.messageType="ack",f.send(JSON.stringify(a))}}}},this.generateHello=function(){var a=g.channels,b={messageType:"hello",uaid:"",channelIDs:[]};if(g.uaid&&(b.uaid=g.uaid),a&&""!==b.uaid)for(var c=a.length,d=c-1;d>-1;d--)b.channelIDs.push(g.channels[d].channelID);return JSON.stringify(b)},this.findChannelIndex=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]===c)return d},this.updateChannel=function(a,b){for(var c=0;c<a.length;c++)if(a[c].channelID===b.channelID){a[c].version=b.version,a[c].state=b.state,a[c].pushEndpoint=b.pushEndpoint;break}return a},this.bindSubscribeSuccess=function(a,b){jQuery(navigator.push).off(a+"-success"),jQuery(navigator.push).on(a+"-success",function(a){b.onsuccess(a)})}},AeroGear.Notifier.adapters.SimplePush.prototype.connect=function(a){a=a||{};var c=this,d=this.getUseNative()?new WebSocket(a.url||this.getConnectURL()):new SockJS(a.url||this.getConnectURL(),b,a);d.onopen=function(){d.send(c.generateHello())},d.onerror=function(){a.onConnectError&&a.onConnectError.apply(this,arguments)},d.onmessage=function(b){var d=c.getPushStore();b=JSON.parse(b.data),"hello"===b.messageType?(b.uaid!==d.uaid&&(d.uaid=b.uaid,c.setPushStore(d)),a.onConnect&&a.onConnect(b)):c.processMessage(b)},d.onclose=function(){a.onClose&&a.onClose.apply(this,arguments)},this.setClient(d)},AeroGear.Notifier.adapters.SimplePush.prototype.disconnect=function(a){var b=this.getClient();b.close(),a&&a()},AeroGear.Notifier.adapters.SimplePush.prototype.subscribe=function(a,c){var d,e,f=!1,g=this.getClient(),h=this.getPushStore();c&&this.unsubscribe(this.getChannels()),a=Array.isArray(a)?a:[a],h.channels=h.channels||[],e=h.channels.length;for(var i=0;i<a.length;i++)e&&(d=this.findChannelIndex(h.channels,"state","available"),d!==b&&(this.bindSubscribeSuccess(h.channels[d].channelID,a[i].requestObject),a[i].channelID=h.channels[d].channelID,a[i].state="used",a[i].pushEndpoint=h.channels[d].pushEndpoint,setTimeout(function(a){return function(){jQuery(navigator.push).trigger(jQuery.Event(a.channelID+"-success",{target:{result:a.pushEndpoint}}))}}(a[i]),0),h.channels[d]=a[i],f=!0)),f||(a[i].channelID=a[i].channelID||uuid(),a[i].state="used",this.bindSubscribeSuccess(a[i].channelID,a[i].requestObject),g.send('{"messageType": "register", "channelID": "'+a[i].channelID+'"}'),h.channels.push(a[i])),f=!1;this.setPushStore(h)},AeroGear.Notifier.adapters.SimplePush.prototype.unsubscribe=function(a){var b,c=this.getClient(),d=JSON.parse(localStorage.getItem("ag-push-store"));a=Array.isArray(a)?a:[a];for(var e=0;e<a.length;e++)b=d.channels.filter(function(b){return b.pushEndpoint===a[e]}),c.send('{"messageType": "unregister", "channelID": "'+b[0].channelID+'"}')},function(b,c){b.SimplePushClient=function(d){if(!(this instanceof b.SimplePushClient))return new b.SimplePushClient(d);if(this.options=d||{},navigator.push&&this.options.useNative)return void(d.onConnect&&d.onConnect());if(this.options.useNative)if("WebSocket"in a)this.options.simplePushServerURL="wss://push.services.mozilla.com";else{if(!this.options.simplePushServerURL)throw"SimplePushConfigurationError";this.options.useNative=!1}var e=this,f={onConnect:function(){navigator.push=function(){return{register:function(){var a={onsuccess:function(){}};if(!e.simpleNotifier)throw"SimplePushConnectionError";return e.simpleNotifier.subscribe({requestObject:a}),a},unregister:function(a){e.simpleNotifier.unsubscribe(a)},reconnect:function(){e.simpleNotifier.connect(f)}}}(),navigator.setMessageHandler=navigator.mozSetMessageHandler=function(a,b){c(navigator.push).on(a,function(a){var c=a.message;b.call(this,c)})},e.options.onConnect&&e.options.onConnect()},onClose:function(){e.simpleNotifier.disconnect(e.options.onClose)}};e.simpleNotifier=b.Notifier({name:"agPushNetwork",type:"SimplePush",settings:{connectURL:e.options.simplePushServerURL,useNative:e.options.useNative}}).clients.agPushNetwork,e.simpleNotifier.connect(f)}}(AeroGear,jQuery)}(this);
//# sourceMappingURL=aerogear.custom.min.js.map
